# ⚡ 快速测试自动重建功能

## 🎯 测试步骤

### 1. 删除现有数据库

```powershell
# 在 PowerShell 中
cd SmartTA-Backend
Remove-Item -Recurse -Force .\data\faiss_index
```

### 2. 启动服务

```bash
uvicorn app:app --reload
```

### 3. 观察输出

你应该看到类似这样的输出：

```
INFO:     Started server process
加载嵌入模型: sentence-transformers/all-mpnet-base-v2
向量数据库不存在，尝试自动重建...
当前目录: E:\College\Project-SmartTA\SmartTA-Backend
项目根目录: E:\College\Project-SmartTA
开始搜索PDF文件...
  ❌ ./data/pdfs 不存在
  ❌ C:\SmartTA\src\pdf 不存在
  ✅ E:\College\Project-SmartTA\SmartTA\src\pdf 存在但无PDF文件  ⬅️ 如果有这个问题，说明路径正确但无PDF
  ✅ E:\College\Project-SmartTA\SmartTA\src\pdf 找到 8 个PDF文件  ⬅️ 正常情况
找到 8 个PDF文件：
  - L1.pdf
  - L2.pdf
  - L3.pdf
  - L4.pdf
  - L5.pdf
  ... 还有 3 个文件
开始重建数据库...
  处理: L1.pdf
  处理: L2.pdf
  ...
✅ 数据库重建完成！添加了 156 个文档块
加载向量数据库: ./data/faiss_index
INFO:     Application startup complete.
```

---

## 🔍 预期结果

### ✅ 成功的情况

1. 看到 "在 [路径] 找到 [数量] 个PDF文件"
2. 看到 "✅ 数据库重建完成！"
3. 服务正常启动

### ❌ 失败的情况

如果看到 "未找到PDF文件" 或 "向量数据库不存在且未找到PDF文件"：

**请运行测试脚本查看详细信息**：
```bash
python test_rebuild.py
```

---

## 📊 调试信息

启动时会打印详细的搜索路径信息：

- 当前目录：你启动服务的位置
- 项目根目录：计算的项目根目录
- 每个搜索路径的检查结果
- 找到PDF文件的路径

**注意**：`project_root` 应该指向 `E:\College\Project-SmartTA`

---

## ⚠️ 常见问题

### 问题1：找不到PDF文件

**症状**：看到 "❌ [路径] 不存在" 或 "未找到PDF文件"

**解决**：
1. 确认PDF文件在 `SmartTA/src/pdf/` 目录
2. 检查 project_root 计算是否正确
3. 手动添加绝对路径

### 问题2：路径存在但无PDF文件

**症状**：看到 "⚠️ [路径] 存在但无PDF文件"

**解决**：
- 确认目录中有 `.pdf` 文件
- 检查文件权限

### 问题3：重建很慢

**症状**：启动需要几分钟

**解决**：
- 正常现象，首次重建需要时间
- 可以观察日志了解进度

---

## 🎉 验证成功

重建成功后，测试提问功能：

```bash
curl -X POST http://localhost:8000/ask \
  -H "Content-Type: application/json" \
  -d '{"question": "什么是操作系统"}'
```

应该能正常返回答案。

---

## 📝 如果还是不工作

请提供以下信息：

1. 启动时的完整输出（特别是搜索路径部分）
2. PDF文件的确切位置
3. 当前工作目录

然后我可以进一步调整搜索路径。

