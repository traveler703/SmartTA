# 🔧 模型加载问题修复说明

## 问题原因

配置文件中使用了错误的模型名称 `text-embedding-3-small`（这是OpenAI的模型），导致无法加载。

## ✅ 已修复

已更新 `rag_engine/config.py`，使用正确的 HuggingFace sentence-transformers 模型：
- `sentence-transformers/all-MiniLM-L6-v2`

---

## 🚀 解决方法

### 方法1：重启服务（推荐）

1. 停止当前运行的服务（按 Ctrl+C）
2. 重启服务：

```bash
cd SmartTA-Backend
uvicorn app:app --reload
```

### 方法2：如果需要重新初始化数据库

如果还是有问题，可能需要重新构建向量数据库：

```bash
cd SmartTA-Backend

# 备份现有数据库（可选）
mv data/faiss_index data/faiss_index_backup

# 重新处理PDF文件
# 使用你之前上传PDF的方式
```

---

## 📝 可用的 HuggingFace 模型

以下是常用的 sentence-transformers 模型，你可以根据需要修改配置：

### 1. all-MiniLM-L6-v2（推荐，已配置）
- **优点**：小巧快速，适合生产环境
- **大小**：约 80MB
- **速度**：快
- **准确性**：中等

### 2. all-mpnet-base-v2
- **优点**：更准确
- **大小**：约 420MB
- **速度**：中等
- **准确性**：高

### 3. multilingual-e5-base
- **优点**：支持多语言（包括中文）
- **大小**：约 560MB
- **速度**：慢
- **准确性**：高（对中文更好）

### 4. paraphrase-multilingual-MiniLM-L12-v2
- **优点**：多语言支持
- **大小**：约 420MB
- **速度**：中等
- **准确性**：中等

---

## 🔄 如何切换模型

编辑 `rag_engine/config.py`：

```python
# 当前的配置（推荐）
embedding_model: str = "sentence-transformers/all-MiniLM-L6-v2"

# 如果需要更高的准确度
embedding_model: str = "sentence-transformers/all-mpnet-base-v2"

# 如果需要多语言支持
embedding_model: str = "intfloat/multilingual-e5-base"
```

修改后重启服务即可。

---

## ⚠️ 注意事项

1. **首次加载模型**：首次启动会从 HuggingFace 下载模型，可能需要几分钟
2. **模型大小**：不同的模型占用内存不同
3. **数据库兼容性**：切换模型后，现有的向量数据库可能不兼容，需要重新构建

---

## 🧪 验证修复

重启服务后，测试健康检查：

```bash
curl http://localhost:8000/health
```

应该返回：
```json
{
  "status": "healthy",
  "model_ready": true
}
```

然后测试提问功能，应该可以正常工作。

